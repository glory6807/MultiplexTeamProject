<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mtms.mapper.ScheduleMapper">

	<insert id="insert">
		<selectKey keyProperty="scheduleNo" order="BEFORE" resultType="Integer">
			SELECT seq_schedule.nextval FROM dual
		</selectKey>
			INSERT INTO schedule VALUES (#{scheduleNo}, #{scheduleDate}, #{scheduleTime}, #{screen}, #{movieNo})
<!-- 		INSERT ALL -->
<!-- 		INTO schedule VALUES (#{scheduleNo}, #{scheduleDate}, #{scheduleTime}, #{screen}, #{movieNo}) -->
<!-- 		INTO seat VALUES (#{scheduleNo}, 'A1', 0) -->
<!-- 		SELECT * FROM DUAL -->
		
<!-- 		SELECT seq_schedule.currval FROM dual : 로 이번 scheduleNo 쿼리 찾아와서 seat에 insert하기^^--> 

<!-- 		INSERT ALL -->
<!-- 		INTO schedule VALUES (#{scheduleNo}, #{scheduleDate}, #{scheduleTime}, #{screen}, #{movieNo}) -->
<!-- 		INTO seat(scheduleNo, seatNo) VALUES -->
<!-- 			<foreach item="item" index="index" collection="list"> -->
<!-- 				(#{scheduleNo}, #{item, jdbcType=VARCHAR}) -->
<!-- 			</foreach> -->
<!-- 		SELECT * FROM DUAL -->
	</insert>
	
	<select id="getSeq" resultType="int">
		SELECT seq_schedule.currval FROM dual
	</select>


<!-- 	<update id="update"> -->
<!-- 	</update> -->
	
<!-- 	<delete id="delete"> -->
<!-- 	</delete> -->

	<delete id="deleteAll">
		DELETE FROM schedule WHERE to_char(scheduleDate, 'yyyymmdd') = #{scheduleDate}
	</delete>
	
	
	<resultMap type="com.mtms.domain.ScheduleVO" id="scheduleMap">
		<!-- property VO에 있는 이름 column 디비에 있는 이름 -->
		<id property="movieNo" column="movieNo"/> <!-- 조인 칼럼  -->
		<result property="scheduleNo" column="scheduleNo"/>
		<result property="scheduleDate" column="scheduleDate"/>
		<result property="scheduleTime" column="scheduleTime"/>
		<result property="screen" column="screen"/>
		<result property="movieNo" column="movieNo"/>
		<association property="movieVO" resultMap="movieMap"/>
	</resultMap>
	
	<resultMap type="com.mtms.domain.MovieVO" id="movieMap">
		<result property="movieNo" column="movieNo"/>
		<result property="movieTitle" column="movieTitle"/>
	</resultMap>
	
	<select id="getDay" resultType="java.lang.String">
		SELECT DISTINCT to_char(s.scheduleDate, 'yyyymmdd') FROM schedule s, movie m
		WHERE #{movieNo} = s.movieNo AND to_char(s.scheduleDate, 'yyyymmdd') BETWEEN #{startDate} AND #{endDate} ORDER BY to_char(s.scheduleDate, 'yyyymmdd')
	</select>
	
	<select id="getTime" resultType="java.lang.String">
		SELECT DISTINCT scheduleTime FROM schedule WHERE movieNo = #{movieNo} and to_char(scheduleDate, 'yyyymmdd') = #{scheduleDate} ORDER BY scheduleTime
	</select>
	
	<select id="getMovie" resultMap="scheduleMap">
		select distinct m.movieTitle, m.movieNo from movie m, schedule s where s.movieNo = m.movieNo and to_char(s.scheduleDate, 'yyyymmdd') between '20200117' and '20200119'
	</select>
	
	<select id="get" resultMap="scheduleMap">
		SELECT m.*, to_char(s.scheduleDate, 'yyyymmdd'), s.scheduleTime, s.screen FROM schedule s, movie m
		WHERE to_char(s.scheduleDate, 'yyyymmdd') = #{scheduleDate} and s.screen = #{screen} and s.movieNo = m.movieNo
	</select>
	
<!-- 	<select id="get" resultType="com.mtms.domain.ScheduleMovieVO"> -->
<!-- 		SELECT m.*, to_char(s.scheduleDate, 'yyyymmdd'), s.scheduleTime, s.screen FROM schedule s, movie m -->
<!-- 		WHERE to_char(s.scheduleDate, 'yyyymmdd') = #{scheduleDate} and s.screen = #{screen} and s.movieNo = m.movieNo -->
<!-- 	</select> -->

</mapper>